<!DOCTYPE html>
<html>
<head>
    <title>MeetingGuard - Instant localStorage Fix</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 50px auto; 
            padding: 20px;
            background: #f5f5f5;
        }
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button { 
            background: #dc3545; 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            font-size: 16px; 
            border-radius: 5px; 
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover { background: #c82333; }
        .success { background: #28a745; }
        .success:hover { background: #218838; }
        #output { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            padding: 15px; 
            margin: 20px 0; 
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .warning { 
            background: #fff3cd; 
            border: 1px solid #ffeaa7; 
            padding: 15px; 
            border-radius: 5px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® MeetingGuard - Instant localStorage Fix</h1>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Problem:</strong> Your app is generating hundreds of 404 errors because localStorage contains old alert schedules for deleted meetings.
        </div>
        
        <h2>üöÄ Instant Solution</h2>
        <p>Click the button below to immediately fix the issue:</p>
        
        <button onclick="emergencyFix()" id="fixBtn">üö® EMERGENCY FIX - Remove Alert Schedules</button>
        <button onclick="showStats()" class="success">üìä Show localStorage Stats</button>
        <button onclick="nuclearOption()" style="background: #6c757d;">‚ò¢Ô∏è Nuclear Reset (if needed)</button>
        
        <div id="output"></div>
        
        <h3>üìã Manual Instructions</h3>
        <p>Or copy this code into your browser console:</p>
        <textarea readonly style="width: 100%; height: 100px; font-family: monospace;">
(function emergencyFix() {
  const alertKeys = Object.keys(localStorage).filter(key => key.startsWith('alertSchedule_'));
  console.log(`üîç Found ${alertKeys.length} alert schedules to remove`);
  alertKeys.forEach(key => localStorage.removeItem(key));
  console.log(`‚úÖ Removed ${alertKeys.length} alert schedules - refresh your app!`);
})();
        </textarea>
    </div>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            output.textContent += new Date().toLocaleTimeString() + ' - ' + message + '\n';
            output.scrollTop = output.scrollHeight;
        }

        function emergencyFix() {
            log('üö® EMERGENCY FIX: Starting localStorage cleanup...');
            
            try {
                const alertKeys = Object.keys(localStorage).filter(key => key.startsWith('alertSchedule_'));
                log(`üîç Found ${alertKeys.length} alert schedules to remove`);
                
                if (alertKeys.length === 0) {
                    log('‚úÖ No alert schedules found - localStorage is already clean!');
                    return;
                }
                
                alertKeys.forEach(key => {
                    localStorage.removeItem(key);
                    log(`üóëÔ∏è Removed: ${key}`);
                });
                
                log(`‚ö° Emergency fix completed! Removed ${alertKeys.length} items`);
                log('üîÑ REFRESH your MeetingGuard app to see clean logs!');
                log('üéâ The 404 errors should be completely gone now!');
                
                document.getElementById('fixBtn').textContent = '‚úÖ Fix Completed!';
                document.getElementById('fixBtn').style.background = '#28a745';
                
            } catch (error) {
                log(`‚ùå Error during cleanup: ${error.message}`);
            }
        }

        function showStats() {
            log('üìä Analyzing localStorage...');
            
            const allKeys = Object.keys(localStorage);
            const alertKeys = allKeys.filter(key => key.startsWith('alertSchedule_'));
            const cacheKeys = allKeys.filter(key => key.startsWith('cache_'));
            const tempKeys = allKeys.filter(key => key.includes('temp'));
            
            log(`üìã localStorage Stats:`);
            log(`   Total keys: ${allKeys.length}`);
            log(`   Alert schedules: ${alertKeys.length}`);
            log(`   Cache items: ${cacheKeys.length}`);
            log(`   Temp items: ${tempKeys.length}`);
            
            if (alertKeys.length > 0) {
                log(`üîç Alert schedule examples:`);
                alertKeys.slice(0, 3).forEach(key => log(`   - ${key}`));
                if (alertKeys.length > 3) {
                    log(`   ... and ${alertKeys.length - 3} more`);
                }
            }
        }

        function nuclearOption() {
            if (confirm('‚ö†Ô∏è WARNING: This will clear ALL localStorage except auth tokens. Continue?')) {
                log('‚ò¢Ô∏è NUCLEAR OPTION: Clearing all localStorage...');
                
                try {
                    // Backup essential data
                    const authToken = localStorage.getItem('authToken');
                    const userData = localStorage.getItem('user_data');
                    const refreshToken = localStorage.getItem('refresh_token');
                    
                    const beforeCount = Object.keys(localStorage).length;
                    localStorage.clear();
                    
                    // Restore essential data
                    if (authToken) localStorage.setItem('authToken', authToken);
                    if (userData) localStorage.setItem('user_data', userData);
                    if (refreshToken) localStorage.setItem('refresh_token', refreshToken);
                    
                    log(`‚ò¢Ô∏è Nuclear reset completed - cleared ${beforeCount} items`);
                    log('üîë Essential auth data preserved');
                    log('üîÑ REFRESH your app - it will be completely clean!');
                    
                } catch (error) {
                    log(`‚ùå Nuclear option failed: ${error.message}`);
                }
            }
        }

        // Auto-run stats on page load
        window.onload = function() {
            log('üîß MeetingGuard localStorage Fix Tool loaded');
            showStats();
        };
    </script>
</body>
</html>
